# Property Handling

This section describes how properties can be injected into object configuration file templates. It is important to understand how this works so you may build configurable templates which make use of the values passed down by the Lifecycle Manager (LM) to create requests handled by the driver.

# Create Request Templates

On create, the Kubernetes driver will render the object configuration file template, then proceed to make requests in the target Kubernetes deployment location to create each object specified in the file.

By now you should have read through [Infrastructure Templates](./infrastructure-templates.md) and have an understanding of the template syntax used to inject property values into the object configuration before it is created: 

```
## Example template syntax to inject value of property "dataA"
apiVersion: v1
kind: ConfigMap
metadata:
  name: example-a
data:
  dataA: {{ dataA }}
  dataB: valueB
```

Your templates may make use of two groups of properties given to the driver on a create request: 

- Resource Properties - a dictionary of values for properties defined on the Resource descriptor
- System Properties - a dictionary of values for properties generated by LM and/or Brent

The following sections cover each group in more detail. 

## Resource Properties

This group refers to values of the Resource instance for properties defined on the Resource descriptor: 

```
# Example Resource descriptor
properties:
  propA:
    type: string
  propB: 
    type: string
    default: B
```

The current value of each property, set by the Assembly instance owning this Resource, is directly accessible using it's name from the descriptor. For example, `propA` and `propB` from above can be used as follows:

```
## Object configuration file template
apiVersion: v1
kind: ConfigMap
metadata:
  name: example-a
data:
  dataA: {{ propA }}
  dataB: {{ propB }}
```

## System Properties

This group refers to properties generated by LM for the Resource instance and include:

| Property Name  | Description |
| ------------------------- | -------------- |
| resourceId                | The LM resource instance ID |
| resourceName | The LM resource instance name
| requestId                         | The LM orchestration request ID     |
| metricKey                         | The LM resource metric key (if set)     |
| resourceManagerId                         | The LM resource manager ID     |
| deploymentLocation                         | The name of the LM deployment location name in which the resource instance resides    |
| resourceType                         | The resource instance type |

The value of these properties can be used in a template under the `systemProperties` key. For example to use the resourceId value can be used as follows:

```
## Object configuration file template
apiVersion: v1
kind: ConfigMap
metadata:
  name: example-a
data:
  resourceId: {{ systemProperties.resourceId }}
  # Alternative
  #resourceId: {{ systemProperties['resourceId'] }}
```

In addition, the driver generates additional "Kubernetes safe" versions of the resourceId and resourceName:

| Property Name  | Description |
| ------------------------- | -------------- |
| resourceSd (or resourceSubdomain)                | LM resource instance name and ID joined and converted to a [Kubernetes safe subdomain name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names) |
| resourceLabel | The LM resource instance name and ID joined and converted to a [Kubernetes safe label name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names) |
| resourceIdSd (or resourceIdSubdomain)                | LM resource instance ID converted to a [Kubernetes safe subdomain name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names) |
| resourceIdLabel                | LM resource instance ID converted to a [Kubernetes safe label name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names) |
| resourceNameSd (or resourceNameSubdomain) | The LM resource instance name converted to a [Kubernetes safe subdomain name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names) |
| resourceNameLabel | The LM resource instance name converted to a [Kubernetes safe label name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names) |

If intending to use the name or identifier of the Resource to name a Kubernetes object (the `metadata.name` value on an object) then you should use `resourceSd` or `resourceLabel` as this combines the ID and name, therefore it is unique but maintains some human readability:

```
## Object configuration file template
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ systemProperties.resourceSd }}
```