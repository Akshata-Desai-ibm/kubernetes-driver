# Available Properties

Your templates (and ready check/output extraction scripts through the `props` variable) may make use of three groups of properties given to the driver on a create request: 

- Resource Properties - a dictionary of values for properties defined on the Resource descriptor
- System Properties - a dictionary of values for properties generated by ALM, Brent and this driver
- Deployment Location - a dictionary copy of the deployment location object

The following sections cover each group in more detail. 

**Table of Contents**:

- [Resource Properties](#resource-properties)
  - [Key Properties](#key-properties)
- [System Properties](#system-properties)
- [Deployment Location](#deployment-location)
- [Using properties in scripts](#using-properties-in-scripts)

## Resource Properties

This group refers to values of the Resource instance for properties defined on the Resource descriptor:.

Example Resource descriptor:
```
properties:
  propA:
    type: string
  propB: 
    type: string
    default: B
```

The value  of each property, at the time of the request, from the instance of this Resource, is directly accessible using it's name from the descriptor. For example, `propA` and `propB` from above can be used as follows in an object configuration template:

```
apiVersion: v1
kind: ConfigMap
metadata:
  name: example-a
data:
  dataA: {{ propA }}
  dataB: {{ propB }}
```

### Key Properties

For key properties (those with `type: key` in the Resource descriptor) you can reference the key name, private key and public key (if set). For example, if you had a `myKey` property in the descriptor, you can template the values as below:

```
apiVersion: v1
kind: Secret
metadata:
  name: example-keys
data:
  keyName: {{ myKey.keyName }}
  privateKey: {{ myKey.privateKey }}
  publicKey: {{ myKey.publicKey }}
```

## System Properties

This group refers to properties generated by LM for the Resource instance and include:

| Property Name  | Description |
| ------------------------- | -------------- |
| resourceId                | The LM resource instance ID |
| resourceName | The LM resource instance name
| requestId                         | The LM orchestration request ID     |
| metricKey                         | The LM resource metric key (if set)     |
| resourceManagerId                         | The LM resource manager ID     |
| deploymentLocation                         | The name of the LM deployment location name in which the resource instance resides    |
| resourceType                         | The resource instance type |

The value of these properties can be used in a template under the `system_properties` key. For example to use the resourceId value can be used as follows:

```
## Object configuration file template
apiVersion: v1
kind: ConfigMap
metadata:
  name: example-a
data:
  resourceId: {{ system_properties.resourceId }}
  # Alternative
  #resourceId: {{ system_properties['resourceId'] }}
```

In addition, the driver generates additional "Kubernetes safe" versions of the resourceId and resourceName:

| Property Name  | Description |
| ------------------------- | -------------- |
| resourceSd/resource_sd/resourceSubdomain/resourceSubdomain                | LM resource instance name and ID joined and converted to a [Kubernetes safe subdomain name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names) |
| resourceLabel/resource_label | The LM resource instance name and ID joined and converted to a [Kubernetes safe label name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names) |
| resourceIdSd/resource_id_sd/resourceIdSubdomain/resource_id_subdomain               | LM resource instance ID converted to a [Kubernetes safe subdomain name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names) |
| resourceIdLabel/resource_id_label                | LM resource instance ID converted to a [Kubernetes safe label name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names) |
| resourceNameSd/resource_name_sd/resourceNameSubdomain/resource_name_subdomain| The LM resource instance name converted to a [Kubernetes safe subdomain name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names) |
| resourceNameLabel/resource_name_label | The LM resource instance name converted to a [Kubernetes safe label name](https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names) |

If intending to use the name or identifier of the Resource to name a Kubernetes object (the `metadata.name` value on an object) then you should use `resource_sd` or `resource_label` as this combines the ID and name, therefore it is unique but maintains some human readability:

Object configuration file template:
```
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ system_properties.resource_sd }}
```

Ultimately, using the `resource_id_sd` will guarantee uniqueness:

Object configuration file template:
```
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ system_properties.resource_id_sd }}
```

## Deployment Location

All Resources have a property called `deploymentLocation`, which will indicate the name of the location in use. In addition, the full details of this deployment location are available under the `deployment_location` key`:

Object configuration file template:
```
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ system_properties.resource_sd }}
data:
  deploymentLocationName: {{ deploymentLocation }}
  theSameDeploymentLocationName: {{ deployment_location.name }}
  storageNamespace: {{ deployment_location.properties.defaultObjectNamespace }}
```

**Note:** although the properties on a Kubernetes deployment location may have been provided as `snake_case`, they must be referenced by `camelCase` in templates.

## Using properties in scripts

To access these properties in ready check/output scripts you should not use the Jinja templating syntax shown in the above examples. Instead, you can navigate through the `props` dictionary provided as an argument to the script:

```python
def getOutputs(keg, props, resultBuilder, log, *args, **kwargs):
  propA = props['propA']
  resourceId = props['system_properties']['resourceId']
  storageNamespace = props['deployment_location']['properties']['defaultObjectNamespace']
```